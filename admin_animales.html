<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Animales</title>
    <link rel="stylesheet" href="css/menu_adm.css">
    <link rel="stylesheet" href="css/animales.css">
</head>
<body>
  <header>
    <nav class="sidebar">
      <h2><img src="img/logo.png" alt="logo" width="150" height="150"> </h2>
      <ul>
        <li><a href="menu_admin.html">Inicio</a></li>
        <li><a href="admin_animales.html">Animales</a></li>
        <li><a href="admin_usuarios.html">Usuarios</a></li>
      </ul>
      <hr>
      <ul>
        <li><a href="menu.html">Cerrar Sesión</a></li>
      </ul>
    </nav>
  </header>

  <main class="contenido">
    <h1>¡Animales!</h1>
    <p>Aquí puedes administrar los animales</p>

    <!-- Botón para agregar un nuevo animal -->
    <button onclick="abrirModal('modalAgregar')">Agregar Animal</button>

    <!-- Tabla para mostrar los animales -->
    <table id="tablaAnimales">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Especie</th>
                <th>Descripción</th>
                <th>Precio</th>
                <th>Imagen</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aquí se llenarán los animales dinámicamente -->
        </tbody>
    </table>

    <!-- Modal para agregar animales -->
    <div id="modalAgregar" class="modal">
        <h2>Agregar Animal</h2>
        <form id="formAgregar">
            <label>Nombre:</label>
            <input type="text" id="nombre" required><br>
            <label>Especie:</label>
            <input type="text" id="especie" required><br>
            <label>Descripción:</label>
            <textarea id="descripcion" required></textarea><br>
            <label>Precio:</label>
            <input type="number" id="precio" required><br>
            <label>Imagen (URL):</label>
            <input type="text" id="imagen" required><br>
            <button type="button" onclick="cerrarModal('modalAgregar')">Cancelar</button>
            <button type="submit">Guardar</button>
        </form>
    </div>

    <!-- Modal para editar animales -->
    <div id="modalEditar" class="modal">
        <h2>Editar Animal</h2>
        <form id="formEditar">
            <input type="hidden" id="editarId">
            <label>Nombre:</label>
            <input type="text" id="editarNombre" required><br>
            <label>Especie:</label>
            <input type="text" id="editarEspecie" required><br>
            <label>Descripción:</label>
            <textarea id="editarDescripcion" required></textarea><br>
            <label>Precio:</label>
            <input type="number" id="editarPrecio" required><br>
            <label>Imagen (URL):</label>
            <input type="text" id="editarImagen" required><br>
            <button type="button" onclick="cerrarModal('modalEditar')">Cancelar</button>
            <button type="submit">Guardar</button>
        </form>
    </div>
  </main>

  <script>
      // Obtener animales desde localStorage
      let animales = JSON.parse(localStorage.getItem("animales")) || [];

      // Función para mostrar los animales en la tabla
      function mostrarAnimales() {
          const tabla = document.querySelector("#tablaAnimales tbody");
          tabla.innerHTML = ""; // Limpia la tabla

          animales.forEach((animal, index) => {
              const fila = `
                  <tr>
                      <td>${animal.nombre || "Editar"}</td>
                      <td>${animal.especie || "Editar"}</td>
                      <td>${animal.descripcion || "Editar"}</td>
                      <td>$${animal.precio || "Editar"}</td>
                      <td><img src="${animal.imagen || ""}" width="100"></td>
                      <td>
                          <button onclick="abrirModalEditar(${index})">Editar</button>
                      </td>
                  </tr>
              `;
              tabla.innerHTML += fila;
          });
      }

      // Función para abrir un modal
      function abrirModal(idModal) {
          document.getElementById(idModal).style.display = "block";
      }

      // Función para cerrar un modal
      function cerrarModal(idModal) {
          document.getElementById(idModal).style.display = "none";
      }

      // Función para agregar un nuevo animal
      document.getElementById("formAgregar").addEventListener("submit", function (e) {
          e.preventDefault();
          const nuevoAnimal = {
              id: animales.length + 1,
              nombre: document.getElementById("nombre").value,
              especie: document.getElementById("especie").value,
              descripcion: document.getElementById("descripcion").value,
              precio: parseFloat(document.getElementById("precio").value),
              imagen: document.getElementById("imagen").value
          };
          animales.push(nuevoAnimal);
          localStorage.setItem("animales", JSON.stringify(animales)); // Guardar en localStorage
          cerrarModal("modalAgregar");
          mostrarAnimales();
      });

      // Función para abrir el modal de edición con los datos del animal
      function abrirModalEditar(index) {
          const animal = animales[index];
          document.getElementById("editarId").value = index;
          document.getElementById("editarNombre").value = animal.nombre || "";
          document.getElementById("editarEspecie").value = animal.especie || "";
          document.getElementById("editarDescripcion").value = animal.descripcion || "";
          document.getElementById("editarPrecio").value = animal.precio || "";
          document.getElementById("editarImagen").value = animal.imagen || "";
          abrirModal("modalEditar");
      }

      // Función para guardar los cambios al editar un animal
      document.getElementById("formEditar").addEventListener("submit", function (e) {
          e.preventDefault();
          const index = document.getElementById("editarId").value;
          animales[index] = {
              id: animales[index].id,
              nombre: document.getElementById("editarNombre").value,
              especie: document.getElementById("editarEspecie").value,
              descripcion: document.getElementById("editarDescripcion").value,
              precio: parseFloat(document.getElementById("editarPrecio").value),
              imagen: document.getElementById("editarImagen").value
          };
          localStorage.setItem("animales", JSON.stringify(animales)); // Guardar en localStorage
          cerrarModal("modalEditar");
          mostrarAnimales();
      });

      // Mostrar los animales al cargar la página
      mostrarAnimales();
  </script>
</body>
</html>